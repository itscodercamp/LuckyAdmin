<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Lubricant Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="admin-wrapper">
        <!-- Collapsible Sidebar -->
        <aside id="sidebar">
            <div class="sidebar-header">
                <h2>Lucky Admin</h2>
                <button class="toggle-sidebar desktop-only" onclick="toggleSidebar()">
                    <i class="ph ph-list"></i>
                </button>
                <button class="toggle-sidebar mobile-only" onclick="toggleMobileSidebar()" style="display: none;">
                    <i class="ph ph-x"></i>
                </button>
            </div>
            <nav class="nav-links">
                <a href="{{ url_for('admin_routes.dashboard') }}"
                    class="nav-item {{ 'active' if request.endpoint == 'admin_routes.dashboard' }}">
                    <i class="ph ph-squares-four nav-icon"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="{{ url_for('admin_routes.users_list') }}"
                    class="nav-item {{ 'active' if request.endpoint == 'admin_routes.users_list' }}">
                    <i class="ph ph-users nav-icon"></i>
                    <span class="nav-text">Customers</span>
                </a>
                <a href="{{ url_for('admin_routes.qr_management') }}"
                    class="nav-item {{ 'active' if request.endpoint == 'admin_routes.qr_management' }}">
                    <i class="ph ph-qr-code nav-icon"></i>
                    <span class="nav-text">QR Batches</span>
                </a>
                <a href="{{ url_for('admin_routes.goodies_admin') }}"
                    class="nav-item {{ 'active' if request.endpoint == 'admin_routes.goodies_admin' }}">
                    <i class="ph ph-gift nav-icon"></i>
                    <span class="nav-text">Guddies List</span>
                </a>
                <a href="{{ url_for('admin_routes.redemptions_list') }}"
                    class="nav-item {{ 'active' if request.endpoint == 'admin_routes.redemptions_list' }}">
                    <i class="ph ph-gift nav-icon"></i>
                    <span class="nav-text">Redemptions</span>
                </a>
                <a href="{{ url_for('admin_routes.products_admin') }}"
                    class="nav-item {{ 'active' if request.endpoint == 'admin_routes.products_admin' }}">
                    <i class="ph ph-package nav-icon"></i>
                    <span class="nav-text">Products</span>
                </a>
                <a href="{{ url_for('admin_routes.messages_admin') }}"
                    class="nav-item {{ 'active' if request.endpoint == 'admin_routes.messages_admin' }}">
                    <i class="ph ph-chat-centered-dots nav-icon"></i>
                    <span class="nav-text">Support Messages</span>
                </a>
                <div style="margin-top: auto; padding-top: 2rem;">
                    <a href="{{ url_for('admin_routes.logout') }}" class="nav-item" style="color: #ef4444;">
                        <i class="ph ph-sign-out nav-icon"></i>
                        <span class="nav-text">Logout</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Mobile Overlay -->
        <div id="sidebar-overlay" onclick="toggleMobileSidebar()"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 90; backdrop-filter: blur(2px);">
        </div>

        <!-- Main Content -->
        <main id="main-content">
            <header>
                <div class="header-left" style="display: flex; align-items: center; gap: 1rem;">
                    <button class="mobile-only btn btn-ghost" onclick="toggleMobileSidebar()"
                        style="display: none; padding: 0.5rem;">
                        <i class="ph ph-list" style="font-size: 1.5rem;"></i>
                    </button>
                    <h1 style="font-size: 1.25rem; font-weight: 600; margin: 0;">{{ self.title() if self.title else
                        'Admin Panel' }}</h1>
                </div>
                <div class="user-profile">
                    <!-- Real Notification Bell -->
                    <a href="{{ url_for('admin_routes.dashboard') }}"
                        style="position: relative; margin-right: 1.5rem; cursor: pointer; text-decoration: none;">
                        <i class="ph ph-bell" style="font-size: 1.5rem; color: var(--text-muted);"></i>
                        {% if unread_admin_notifications_count > 0 %}
                        <span
                            style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 700;">
                            {{ unread_admin_notifications_count }}
                        </span>
                        {% endif %}
                    </a>

                    <div class="stat-details" style="text-align: right; margin-right: 0.5rem;">
                        <div style="font-weight: 600; font-size: 0.875rem;">Administrator</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Master Control</div>
                    </div>
                    <div class="avatar">A</div>
                </div>
            </header>

            {% with messages = get_flashed_messages() %}
            {% if messages %}
            {% for message in messages %}
            <div class="badge {{ 'badge-success' if 'success' in message.lower() else 'badge-danger' }}"
                style="display: block; width: 100%; margin-bottom: 1rem; padding: 1rem; border-radius: 8px;">
                {{ message }}
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const main = document.getElementById('main-content');

            sidebar.classList.toggle('collapsed');
            main.classList.toggle('expanded');

            // Save state
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        }

        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sidebar.classList.toggle('show');
            overlay.style.display = sidebar.classList.contains('show') ? 'block' : 'none';
        }

        // Restore sidebar state
        window.addEventListener('DOMContentLoaded', () => {
            if (window.innerWidth > 768 && localStorage.getItem('sidebarCollapsed') === 'true') {
                document.getElementById('sidebar').classList.add('collapsed');
                document.getElementById('main-content').classList.add('expanded');
            }
        });
    </script>

    <style>
        @media (max-width: 768px) {
            .desktop-only {
                display: none !important;
            }

            .mobile-only {
                display: block !important;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>